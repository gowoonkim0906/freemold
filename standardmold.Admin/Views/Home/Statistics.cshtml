@using Freemold.Modules.Models;

@{
    var datelist = ViewBag.datelist as List<StatisticsModel> ?? new List<StatisticsModel>();
    var hourlist = ViewBag.hourlist as List<StatisticsHourModel> ?? new List<StatisticsHourModel>();
    var refererlist = ViewBag.refererlist as List<StatisticsRefererModel> ?? new List<StatisticsRefererModel>();
    var countrylist = ViewBag.countrylist as List<StatisticsCountryModel> ?? new List<StatisticsCountryModel>();
}

<div class="container-fluid px-4">
    <div class="mb-3 mt-4 d-flex align-items-center" role="search">
        <form class="d-flex align-items-center" role="search" id="searchform">
            <input type="text" class="form-control form-control-sm datepicker me-2" style="max-width: 100px;" name="sDate" id="sDate">
            <span class="mx-2">~</span>
            <input type="text" class="form-control form-control-sm datepicker me-2" style="max-width: 100px;" name="eDate" id="eDate">
            <button onclick="datesearch()" class="btn btn-sm btn-primary">검색</button>
        </form>
    </div>
    <div class="row mt-4">
        <div class="col-xl-3">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-area me-1"></i>
                    검색기간 일별 접속자수
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>날짜</th>
                                <th>전체</th>
                                <th>PC</th>
                                <th>Mobile</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>합계</td>
                                <td>@ViewBag.datatotlacnt</td>
                                <td>@ViewBag.datapc</td>
                                <td>@ViewBag.datamobile</td>
                            </tr>
                            @foreach (var item in datelist)
                            {
                                <tr>
                                    <td>@item.InDate</td>
                                    <td>@item.TotalCnt</td>
                                    <td>@(item.TotalCnt - item.Mobile)</td>
                                    <td>@item.Mobile</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-xl-3">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-bar me-1"></i>
                    검색기간 시간대별 접속자수
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>시간</th>
                                <th>전체</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>합계</td>
                                <td>@ViewBag.hourtotal</td>
                            </tr>
                            @foreach (var item in hourlist)
                            {
                                <tr>
                                    <td>@item.sHour</td>
                                    <td>@item.TotalCnt</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-xl-3">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-area me-1"></i>
                    검색기간 유입경로
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>순위</th>
                                <th>경로</th>
                                <th>카운트</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>합계</td>
                                <td></td>
                                <td>@(refererlist.Sum(m => m.TotalCnt))</td>
                            </tr>
                            @{
                                int listnum = 1;
                                foreach (var item in refererlist)
                                 {
                                    <tr>
                                        <td>@listnum</td>
                                        <td>@(item.HttpReferer == "" ? "직접/즐겨찾기" : item.HttpReferer)</td>
                                        <td>@item.TotalCnt</td>
                                    </tr>

                                    listnum++;
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-xl-3">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-bar me-1"></i>
                    검색기간 국가별 경로
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>순위</th>
                                <th>코드</th>
                                <th>국가명</th>
                                <th>카운트</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>합계</td>
                                <td></td>
                                <td></td>
                                <td>@(countrylist.Sum(m => m.TotalCnt))</td>
                            </tr>
                            @{
                                int listcnum = 1;
                                foreach (var item in countrylist)
                                {
                                    <tr>
                                        <td>@listcnum</td>
                                        <td>@item.CCode</td>
                                        <td>@item.CName</td>
                                        <td>@item.TotalCnt</td>
                                    </tr>

                                    listcnum++;
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
   
    function datesearch(){
        
        let sDate = $("#sDate").val();
        let eDate = $("#eDate").val();

        if(sDate == ""){
            alert('날짜를 입력해주세요');
            $("#sDate").focus();
            return;
        }

        if(eDate == ""){
            alert('날짜를 입력해주세요');
            $("#eDate").focus();
            return;
        }


        $("#searchform").submit();

    }
</script>
